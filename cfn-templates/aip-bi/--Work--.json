--Work--
Test AWS - Must assign IP blocks, plan VPN, Update launch params test file


Changes --

AccountNo - using AWS::AccountNo
Region - using AWS::Region

Need Version sorted out - URL should not have version in it - right?

instance keys - using Parameter 'KeyName'

                    "Ref": {"Fn::Join" : ["-", ["elasticbeanstalk", {"Ref" : "AWS::Region" }, {"Ref" : "AWS::AccountNo"}]]},


 "BIAppVersion": {
            "Type": "AWS::ElasticBeanstalk::ApplicationVersion",
            "Properties": {
                "ApplicationName": {
                    "Ref": "BIApp"
                },
                "SourceBundle": {
                    "S3Bucket": {
                        "Ref": "ApplicationSourceBundle"
                    },
                    "S3Key": "aip-bi-eb-app-v1.zip"
                }
            }
        },






aws-elasticbeanstalk-amzn-2015.03.1.x86_64-ecs-hvm-201509182207












    "AppResources" : {
      "Type" : "AWS::CloudFormation::Stack",
      "Metadata" : { "Comment" : "Build AWS Resources per Environment, e.g., S3, RDS" },
      "Properties" : {
        "TemplateURL" : { "Fn::Join" : ["", [ "http://",  "s3.amazonaws.com/", { "Ref" : "ResourcesTemplateKey" }]]},
        "Parameters" : {
          "Environment": { "Ref" : "Environment" },
          "CWatchLogGrpName": { "Ref" : "CWatchLogGrpName" },
          "CWatchLogGrpRetention": { "Ref" : "CWatchLogGrpRetention" }
        }
      }
    },

    "BeanstalkApp1" : {
      "Type" : "AWS::CloudFormation::Stack",
      "Metadata" : { "Comment" : "Beanstalk App - configure, build, deploy" },
      "Properties" : {
        "TemplateURL" : {"Fn::Join" : ["", [ "http://",  "s3.amazonaws.com/", { "Ref" : "AppTemplateKey" }]]},
        "Parameters" : {
            "Environment"              : { "Ref" : "Environment"},

            "ImageId"                  : { "Ref" : "ImageId" },
            "KeyName"                  : { "Ref" : "KeyName" },
            "InstanceType"             : { "Ref" : "InstanceType" },
            "InstanceSecurityGroups"   : { "Fn::GetAtt" : ["VpcScaffold", "Outputs.InstanceSecurityGroups"] },

            "ApplicationName"          : { "Ref" : {"Fn::Join": ["", ["aip-eb-bi-app-", {"Ref": "AWS::Region"}]]}},
            "ApplicationURL"           : { "Ref" : "ApplicationURL"},
            "ApplicationSourceBundle"  : { "Ref" : {"Fn::Join" : ["-", ["elasticbeanstalk", {"Ref" : "AWS::Region"}, {"Ref" : "AWS::AccountNo"}]]}},

            "VpcId"                    : { "Fn::GetAtt" : ["VpcScaffold", "Outputs.VpcId"] },
            "PrivateSubnets" : {
              "Fn::Join": [",", [{ "Fn::GetAtt" : ["VpcScaffold", "Outputs.PrivateSubnet1"]}, { "Fn::GetAtt" : ["VpcScaffold", "Outputs.PrivateSubnet2"]} ]] },
            "PublicSubnets" : {
              "Fn::Join": [",", [{ "Fn::GetAtt" : ["VpcScaffold", "Outputs.PublicSubnet1"]}, { "Fn::GetAtt" : ["VpcScaffold", "Outputs.PublicSubnet2"]} ]] }
          }
        }
      }
  },


  "Outputs": {
    "URL": {
      "Description": "URL of the AWS Elastic Beanstalk Environment",
      "Value": { "Fn::GetAtt": ["BeanstalkApp1", "Outputs.URL"] }
    }
  }
}

    "BeanstalkApp1" : {
      "Type" : "AWS::CloudFormation::Stack",
      "Metadata" : { "Comment" : "Beanstalk App - configure, build, deploy" },
      "Properties" : {
        "TemplateURL" : {"Fn::Join" : ["", [ "http://",  "s3.amazonaws.com/", { "Ref" : "AppTemplateKey" }]]},
        "Parameters" : {
            "Environment"              : { "Ref" : "Environment"},

            "ImageId"                  : { "Ref" : "ImageId" },
            "KeyName"                  : { "Ref" : "KeyName" },
            "InstanceType"             : { "Ref" : "InstanceType" },
            "InstanceSecurityGroups"   : { "Fn::GetAtt" : ["VpcScaffold", "Outputs.InstanceSecurityGroups"] },

            "ApplicationName"          : { "Ref" : {"Fn::Join": ["-", [{"Ref": "ApplicationName"}, {"Ref": "AWS::Region"}]]}},
            "ApplicationURL"           : { "Ref" : "ApplicationURL"},
            "ApplicationSourceBundle"  : { "Ref" : {"Fn::Join" : ["-", ["elasticbeanstalk", {"Ref" : "AWS::Region"}, {"Ref" : "AWS::AccountNo"}]]}},

            "VpcId"                    : { "Fn::GetAtt" : ["VpcScaffold", "Outputs.VpcId"] },
            "PrivateSubnets" : {
              "Fn::Join": [",", [{ "Fn::GetAtt" : ["VpcScaffold", "Outputs.PrivateSubnet1"]}, { "Fn::GetAtt" : ["VpcScaffold", "Outputs.PrivateSubnet2"]} ]] },
            "PublicSubnets" : {
              "Fn::Join": [",", [{ "Fn::GetAtt" : ["VpcScaffold", "Outputs.PublicSubnet1"]}, { "Fn::GetAtt" : ["VpcScaffold", "Outputs.PublicSubnet2"]} ]] }
          }
        }
      }



,
    "ApplicationSourceBundle": {
       "Description": "Debug ApplicationSourceBundle",
       "Value"  : { "Ref" : {"Fn::Join" : ["-", ["elasticbeanstalk", {"Ref" : "AWS::Region"}, {"Ref" : "AWS::AccountNo"}]]}}
    }